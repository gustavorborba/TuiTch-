<link href="~/Content/bootstrap.min.css" rel="stylesheet" type="text/css" />

<textarea class="form-control row" id="textoPublicacao" style="margin-left:435px;" name="comment" placeholder="Fala Tchê!?"></textarea>

<input id="btnPublicar" class="btn-default btn" type="button" value="Publicar" />


<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script>
        var text;
        var textoTag;
        var textoUsuario;
        var tags = [];
        var usuarios = [];
        var matchesTags;
        var matchesUsers;
        var mentions = [];
        var cache = false;
    //$.get( "Publicacao/UsuarioAutocomplete", function( data ) {
    //    mentions = data;

    //});
    //    $('textarea').textcomplete([
    //        { // mention strategy
    //            match: /(^|\s)@@(\w*)$/,
    //            search: function (term, callback) {
    //                callback(cache[term], true);
    //                $.getJSON('/Publicacao/UsuarioAutocomplete', { q: term })
    //                  .done(function (resp) { callback(resp); })
    //                  .fail(function ()     { callback([]);   });
    //            },
    //            replace: function (value) {
    //                return '$1@@' + value + ' ';
    //            },
    //            cache: true
    //        }], { maxCount: 20, debounce: 500 });

        var textarea = document.querySelector('textarea');
        textarea.addEventListener('keyup', function () {
            text = this.value;
            matchesTags = text.match(/([#][^\s]+)/g);
            matchesUsers = text.match(/([@@][^\s]+)/g);
            if (matchesTags) matchesTags.forEach(function (match) {
                textoTag = match.slice(1);
            })
            if (matchesUsers) matchesUsers.forEach(function (match) {
                textoUsuario = match.slice(1);
                console.log(textoUsuario);
            });

        });
        $("#btnPublicar").click(function () {
            if (matchesTags != null) {
                matchesTags.forEach(function (value) {
                    tags.push(value.slice(1));
                });
            }
            if (matchesUsers != null) {
                matchesUsers.forEach(function (value) {
                    usuarios.push(value.slice(1));
                });
            }
            var dataObject = JSON.stringify({
                'hashtags': tags,
                'users': textoUsuario,
                'conteudo': text
            });
            ($('textarea').val(''))
            $.ajax({
                url: '/Publicacao/Publicar',
                type: 'POST',
                contentType: 'application/json',
                data: dataObject
            });
            matchesTags = [];
            matchesUsers = [];
            tags = [];
            usuarios = [];
        });
</script>
